(this["webpackJsonpdocsvision-test-task"]=this["webpackJsonpdocsvision-test-task"]||[]).push([[0],{203:function(e,n,t){e.exports={main:"App_main__3ZkGI",aside:"App_aside__HVdR9",tableSection:"App_tableSection__2qRO3"}},351:function(e,n,t){e.exports=t(422)},421:function(e,n,t){},422:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),c=t(15),i=t.n(c),o=t(36),u=t(24),s=t.n(u),l=t(55),p=t(98),d=t(237),f=(t(361),["main","main-101","main-102","main-head","main-left","main-right","production","production-1","production-2"]);d.initializeApp({apiKey:"AIzaSyD6DnGbVfdJlDJ_pEOUfDfTDJrA8j3lIs8",authDomain:"dv-inventory.firebaseapp.com",databaseURL:"https://dv-inventory.firebaseio.com",projectId:"dv-inventory",storageBucket:"dv-inventory.appspot.com",messagingSenderId:"130062240176",appId:"1:130062240176:web:ecbca5d29b37d25c6cee75"});var v=d.firestore(),m={toFirestore:function(){return{}},fromFirestore:function(e){var n=e.data();return{name:n.name,parts:n.parts}}},y={toFirestore:function(e){return{name:e.name,count:e.count,place:e.place}},fromFirestore:function(e){var n,t=e.data();return{name:t.name,count:t.count,place:{id:null===(n=t.place)||void 0===n?void 0:n.id}}}};function I(){return h.apply(this,arguments)}function h(){return(h=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.collection("places").withConverter(m).get().then((function(e){return e.docs.map((function(e){var n;return{id:e.id,name:e.data().name,parts:null===(n=e.data().parts)||void 0===n?void 0:n.map((function(e){return e.id}))}}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return g.apply(this,arguments)}function g(){return(g=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.collection("inventory").withConverter(y).get().then((function(e){return e.docs.filter((function(e){var n=e.data(),t=n.name,r=n.count,a=n.place;if(a&&a.id&&f.includes(a.id)&&t&&"string"===typeof t&&r&&"number"===typeof r)return!0})).map((function(e){return{id:e.id,name:e.data().name,count:e.data().count,placeId:e.data().place.id}}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return x.apply(this,arguments)}function x(){return(x=Object(l.a)(s.a.mark((function e(n){var t,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.name,r=n.count,a=n.place,f.includes(a.id)){e.next=3;break}throw new Error("\u0422\u0430\u043a\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442!");case 3:return e.next=5,v.collection("inventory").withConverter(y).add({name:t,count:r,place:a}).then((function(e){return e.id}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,n){return O.apply(this,arguments)}function O(){return(O=Object(l.a)(s.a.mark((function e(n,t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.collection("inventory").withConverter(y).doc(n).update(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return P.apply(this,arguments)}function P(){return(P=Object(l.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.collection("inventory").withConverter(y).doc(n).delete();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=Object(p.b)({name:"places",initialState:{placeById:{},allIds:[],isLoading:!1,error:null,activePlaceId:null},reducers:{getPlacesStart:function(e){e.isLoading=!0},getPlacesSucess:function(e,n){var t=n.payload;e.isLoading=!1,e.error=null,t.forEach((function(n){e.allIds.push(n.id),e.placeById[n.id]=n}))},setActivePlaceId:function(e,n){var t=n.payload;e.activePlaceId=t},getPlacesFailure:function(e,n){e.isLoading=!1,e.error=n.payload}}}),k=E.actions,B=k.getPlacesStart,F=k.getPlacesSucess,D=k.setActivePlaceId,A=k.getPlacesFailure,L=E.reducer;function _(e){e.isLoading=!0}function C(e,n){e.isLoading=!1,e.error=n.payload}var R=Object(p.b)({name:"inventory",initialState:{inventoryByPlaceId:{},inventoryById:{},isLoading:!1,error:null},reducers:{getInventoryStart:_,postInventoryStart:_,setInventoryStart:_,deleteInventoryStart:_,getInventorySucess:function(e,n){var t=n.payload;e.isLoading=!1,e.error=null;var r=e.inventoryByPlaceId,a=e.inventoryById;t.forEach((function(e){var n=e.id;e.placeId;a[n]=e})),Object.values(e.inventoryById).forEach((function(e){var n=e.placeId;n in r?r[n].push(e):r[n]=[e]}))},postInventorySucess:function(e,n){var t=n.payload;e.error=null;var r=t.id,a=t.inventory,c=a.name,i=a.count,o=a.place;e.inventoryByPlaceId[o.id]?e.inventoryByPlaceId[o.id].push({id:r,name:c,count:i,placeId:o.id}):e.inventoryByPlaceId[o.id]=[{id:r,name:c,count:i,placeId:o.id}]},setInventorySucess:function(e,n){var t=n.payload;e.error=null;var r=t.placeId,a=t.id,c=t.fields,i=c.name,o=c.count,u=e.inventoryByPlaceId[r].find((function(e){return e.id===a}));u&&(u.name=i,u.count=o)},deleteInventorySucess:function(e,n){var t=n.payload,r=t.placeId,a=t.id;e.inventoryByPlaceId[r]=e.inventoryByPlaceId[r].filter((function(e){return e.id!==a}))},getInventoryFailure:C,postInventoryFailure:C,setInventoryFailure:C,deleteInventoryFailure:C}}),J=R.actions,N=J.getInventoryStart,U=J.postInventoryStart,z=J.setInventoryStart,G=J.deleteInventoryStart,H=J.getInventorySucess,V=J.postInventorySucess,W=J.setInventorySucess,q=J.deleteInventorySucess,K=J.getInventoryFailure,T=J.postInventoryFailure,Z=J.setInventoryFailure,M=J.deleteInventoryFailure,Q=R.reducer,X=t(441),Y=t(443),$=t(339),ee=t.n($),ne=t(340),te=t.n(ne),re=t(338),ae=function(e,n){return function(t){if(!t)return 0;return t.map((function(t){return function t(r,a){var c=e[r],i=n[c.id]?n[c.id].length+a:0;return c.parts?c.parts.reduce((function(e,n){return t(n,e)}),i):i}(t,0)})).reduce((function(e,n){return e+n}),0)}},ce=function(e){var n=e.places,t=e.inventory,r=Object(o.c)(),c=Object(o.d)((function(e){return e.places})),i=c.isLoading,u=(c.error,[]);if(i)return a.a.createElement(re.a,{viewBox:"0 0 400 110",width:"100%",height:"100%"});var s=Object.values(n).filter((function(e){return void 0!==e.parts}));return a.a.createElement(Y.a,{defaultExpandIcon:a.a.createElement(ee.a,null),defaultCollapseIcon:a.a.createElement(te.a,null),onNodeSelect:function(e,n){r(D(n))}},s&&s.map((function(e){return function e(r){var c=r.id,i=r.name,o=r.parts;if(u.includes(c))return null;var s=t[c]?t[c].length:0,l=ae(n,t)(o)+s;return u.push(c),a.a.createElement(X.a,{key:c,nodeId:c,label:l>0?a.a.createElement(a.a.Fragment,null,i,": ",a.a.createElement("b",null,l)):i},o&&o.map((function(t){return e(n[t])})))}(e)})))},ie=t(103),oe=t(341),ue=t.n(oe),se=t(140),le=function(e){var n=e.places,t=e.inventory,r=e.activePlaceId,c=Object(o.c)(),i=Object(o.d)((function(e){return e.places.placeById[r].name})),u=function(e,n,t){return function e(r,a){if(!!!n[r].parts)return t[r]?[].concat(Object(ie.a)(a),Object(ie.a)(t[r].map(se.cloneDeep))):Object(ie.a)(a.map(se.cloneDeep));var c=n[r].parts,i=t[r]?Object(ie.a)(t[r].map(se.cloneDeep)):[];return[].concat(Object(ie.a)(a.map(se.cloneDeep)),Object(ie.a)(null===c||void 0===c?void 0:c.reduce((function(n,t){return e(t,n)}),i)))}(e,[])}(r,n,t);return a.a.createElement(ue.a,{title:i,columns:[{title:"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044c",field:"name",validate:function(e){return""!==e.name}},{title:"\u041a\u043e\u043b-\u0432\u043e",field:"count",type:"numeric",validate:function(e){return e.count>0}}],data:u,style:{maxWidth:"1000px",minWidth:"800px",minHeight:"400px"},editable:{onRowUpdate:function(e,n){return new Promise((function(t){var r,a,i;n&&(c((r=n.placeId,a=n.id,i=e,function(){var e=Object(l.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n(z()),e.next=4,j(a,i);case 4:n(W({placeId:r,id:a,fields:i})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(Z(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}())),t())}))},onRowAdd:function(e){return new Promise((function(n){var t={name:e.name,count:e.count,place:{id:r}};n(),c(function(e){return function(){var n=Object(l.a)(s.a.mark((function n(t){var r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t(U()),n.next=4,w(e);case 4:r=n.sent,t(V({id:r,inventory:e})),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),t(T(n.t0.message));case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()}(t))}))},onRowDelete:function(e){return new Promise((function(n){var t,r;e&&(c((t=e.placeId,r=e.id,function(){var e=Object(l.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n(G()),e.next=4,S(r);case 4:n(q({placeId:t,id:r})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(M(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}())),n())}))}}})},pe=t(203),de=t.n(pe),fe=function(){var e=Object(o.c)(),n=Object(o.d)((function(e){return e.places.placeById})),t=Object(o.d)((function(e){return e.places.activePlaceId})),c=Object(o.d)((function(e){return e.inventory.inventoryByPlaceId}));return Object(r.useEffect)((function(){e(function(){var e=Object(l.a)(s.a.mark((function e(n){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n(B()),e.next=4,I();case 4:t=e.sent,n(F(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(A(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n){return e.apply(this,arguments)}}()),e(function(){var e=Object(l.a)(s.a.mark((function e(n){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n(N()),e.next=4,b();case 4:t=e.sent,n(H(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(K(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n){return e.apply(this,arguments)}}())}),[]),a.a.createElement("div",{className:"App"},a.a.createElement("main",{className:de.a.main},a.a.createElement("aside",{className:de.a.aside},a.a.createElement(ce,{places:n,inventory:c})),a.a.createElement("section",{className:de.a.tableSection},t&&a.a.createElement(le,{places:n,inventory:c,activePlaceId:t}))))},ve=t(35),me=Object(ve.c)({places:L,inventory:Q}),ye=Object(p.a)({reducer:me});t(421);i.a.render(a.a.createElement(o.a,{store:ye},a.a.createElement(fe,null)),document.getElementById("root"))}},[[351,1,2]]]);
//# sourceMappingURL=main.8f18a1f5.chunk.js.map